define(["@grafana/data","react","@emotion/css","@grafana/ui","@grafana/runtime","lodash"],((e,t,l,a,r,o)=>(()=>{"use strict";var n={644:e=>{e.exports=l},305:t=>{t.exports=e},545:e=>{e.exports=r},388:e=>{e.exports=a},980:e=>{e.exports=o},650:e=>{e.exports=t}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var l=i[e]={exports:{}};return n[e](l,l.exports,s),l.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var l in t)s.o(t,l)&&!s.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{s.r(u),s.d(u,{plugin:()=>H});var e=s(305),t=s(650),l=s.n(t),a=s(644),r=s(388);function o(e,t){const l=["information","minor","warning","average","high","critical","disaster"];let a,r,o=-1;if(!t)return o>=0?l[o]+"-state":"ok-state";for(const n of t){let t;for(const i of e)if(new RegExp(n.seriesMatch).test(i.label)){if(t=i,!t)continue;const e=t.value;if("number"===n.displayMode&&n.useCustomThresholds&&n.customThresholds&&n.customThresholds.length>0){const t=[...n.customThresholds].sort(((e,t)=>e.order-t.order));for(const i of t){const t=parseFloat(i.value);if(i.value&&!isNaN(t)&&"number"==typeof e&&(n.revers?e<=t:e>=t)){const e=l.indexOf(i.name);e>o&&(o=e,a=i.color,r=i.textColor)}}}else if("number"===n.displayMode&&n.numberThreshold){for(const[t,a]of Object.entries(n.numberThreshold))if(null!==a){if("showOnlyOnThreshold"===t)continue;if("number"==typeof e&&(n.revers?e<=parseFloat(a):e>=parseFloat(a))){const e=l.indexOf(t);e>o&&(o=e)}}}else if("string"===n.displayMode&&n.stringThreshold)for(const[t,a]of Object.entries(n.stringThreshold))if(String(e)===a){const e=l.indexOf(t);e>o&&(o=e)}}}if(o>=0){const e=l[o]+"-state";return a||r?{state:e,customColor:a,textColor:r}:e}return"ok-state"}const n={eq:(e,t)=>e===t,ne:(e,t)=>e!==t,ge:(e,t)=>e>t,lt:(e,t)=>e<t};function i(e,t,l){const a=n[l];return!!a&&a(e,t)}var d=s(545);function c(e,t,l,a){switch(l){case"name":return e;case"last_time":return t?t.timestamp:Date.now();default:return a[l]}}function h(t,l){const a=[];for(const l of t.fields)l.type!==e.FieldType.number&&l.type!==e.FieldType.string&&l.type!==e.FieldType.time||a.push(l);const r=[];for(const o of a){const a=(0,e.reduceField)({field:o,reducers:["bogus"]}),n=(0,e.getFieldDisplayName)(o,t),i=c(n,null,l,a);let s=4;void 0!==o.config.decimals&&null!==o.config.decimals&&(s=o.config.decimals);let u="";if(o.type===e.FieldType.time){const t=new Date(i);if(o.config.unit){const t=(0,e.getValueFormat)(o.config.unit)(i,s,void 0,void 0);u=(0,e.formattedValueToString)(t)}else u=t.toISOString()}else{const t=(0,e.getValueFormat)(o.config.unit)(i,s,void 0,void 0);u=(0,e.formattedValueToString)(t)}const d={thresholdLevel:0,value:i,valueFormatted:u,valueRounded:m(i,s)||i,stats:a,name:n,displayName:n,timestamp:0,prefix:"",suffix:"",color:"",clickThrough:"",operatorName:"",newTabEnabled:!0,sanitizedURL:"",sanitizeURLEnabled:!0,showName:!0,showValue:!0,isComposite:!1,members:[],fieldType:o.type};r.push(d)}return r}s(980);const m=(e,t)=>{if(null===e)return null;const l=Math.pow(10,t),a=(l*e).toFixed(t);return Math.round(parseFloat(a))/l};function p(e){const t=[];for(const l of e.series){const e=h(l,"last");for(const l of e)t.push({label:l.name,value:l.valueRounded,valueFormatted:l.valueFormatted,fieldType:l.fieldType})}return t}const g=a.css`
    @keyframes blinker {
      from {
        opacity: 1.0;
      }
      50% {
        opacity: 0.5;
      }
      to {
        opacity: 1.0;
      }
    }
  
    @-webkit-keyframes blinker {
      from {
        opacity: 1.0;
      }
      50% {
        opacity: 0.5;
      }
      to {
        opacity: 1.0;
      }
    }
  `,b=[{value:"number",label:"Number threshold"},{value:"string",label:"String threshold"},{value:"show",label:"Show only "}],f=[{value:"eq",label:"Equivalent"},{value:"ne",label:"Not equivalent"},{value:"ge",label:"Greater than"},{value:"lt",label:"Less than"}],v=[{value:"none",label:"None"},{value:"dateTimeAsIso",label:"ISO DateTime"},{value:"dateTimeAsUS",label:"US DateTime"},{value:"dateTimeFromNow",label:"Time from Now"},{value:"s",label:"Seconds"},{value:"ms",label:"Milliseconds"},{value:"dtdurations",label:"Duration (Days/Hours/Minutes/Seconds)"},{value:"dthms",label:"Days/Hours/Minutes/Seconds"},{value:"percent",label:"Percent (0-100)"},{value:"percentunit",label:"Percent (0.0-1.0)"},{value:"bytes",label:"Bytes"},{value:"bits",label:"Bits"},{value:"kbytes",label:"Kilobytes"},{value:"mbytes",label:"Megabytes"},{value:"gbytes",label:"Gigabytes"},{value:"ops",label:"Operations/sec"},{value:"rps",label:"Requests/sec"},{value:"wps",label:"Writes/sec"},{value:"iops",label:"I/O Ops/sec"},{value:"celsius",label:"Celsius"},{value:"fahrenheit",label:"Fahrenheit"},{value:"none",label:"None"},{value:"short",label:"Short"},{value:"hex",label:"Hexadecimal"},{value:"string",label:"String"}];function w(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}const y=({thresholds:e,onChange:t})=>{const a=(0,r.useStyles2)(T),o=(l,a,r)=>{const o=[...e];var n,i;o[l]=(n=function(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{},a=Object.keys(l);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(l).filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})))),a.forEach((function(t){w(e,t,l[t])}))}return e}({},o[l]),i=null!=(i={[a]:r})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);l.push.apply(l,a)}return l}(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})),n),t(o)},n=(l,a)=>{if("up"===a&&0===l||"down"===a&&l===e.length-1)return;const r=[...e],o="up"===a?l-1:l+1;[r[l],r[o]]=[r[o],r[l]],r[l].order=l,r[o].order=o,t(r)};return l().createElement("div",null,l().createElement("h4",null,"Custom Thresholds"),l().createElement("div",{className:a.thresholdList},e.map(((i,s)=>l().createElement("div",{key:`threshold-${s}`,className:a.thresholdRow},l().createElement("div",{className:a.horizontalGroup},l().createElement(r.Input,{placeholder:"Name",value:i.name,onChange:e=>o(s,"name",e.currentTarget.value),width:15}),l().createElement(r.Input,{placeholder:"Value",value:i.value,onChange:e=>o(s,"value",e.currentTarget.value),width:15}),l().createElement("div",{className:a.colorPickerContainer},l().createElement("label",null,"Background:"),l().createElement(r.ColorPicker,{color:i.color,onChange:e=>o(s,"color",e)})),l().createElement("div",{className:a.colorPickerContainer},l().createElement("label",null,"Text:"),l().createElement(r.ColorPicker,{color:i.textColor||"#080808",onChange:e=>o(s,"textColor",e)})),l().createElement(r.IconButton,{name:"arrow-up",onClick:()=>n(s,"up")}),l().createElement(r.IconButton,{name:"arrow-down",onClick:()=>n(s,"down")}),l().createElement(r.IconButton,{name:"trash-alt",onClick:()=>(l=>{const a=[...e];a.splice(l,1),t(a)})(s)})))))),l().createElement(r.Button,{variant:"secondary",icon:"plus",onClick:()=>{const l=e.length>0?Math.max(...e.map((e=>e.order)))+1:0,a={name:`threshold${l}`,value:"",color:"rgb(50, 116, 217)",textColor:"#ffffff",order:l};t([...e,a])},className:a.addButton},"Add Threshold"))},T=e=>({thresholdList:a.css`
      margin-bottom: ${e.spacing(2)};
    `,thresholdRow:a.css`
      margin-bottom: ${e.spacing(1)};
      padding: ${e.spacing(1)};
      border-radius: ${e.shape.borderRadius()};
      background: ${e.colors.background.secondary};
    `,horizontalGroup:a.css`
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: ${e.spacing(1)};
    `,addButton:a.css`
      margin-top: ${e.spacing(1)};
    `,colorPickerContainer:a.css`
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      
      label {
        font-size: 0.8rem;
        margin-bottom: 2px;
      }
    `});function C(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function E(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{},a=Object.keys(l);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(l).filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})))),a.forEach((function(t){C(e,t,l[t])}))}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);l.push.apply(l,a)}return l}(Object(t)).forEach((function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(t,l))})),e}const S=a=>{var o,n,i,s,u,d,c,m,p,g,w,T,C,S,k,O,F,R,I,P;const[M,D]=(0,t.useState)([]),[V,N]=(0,t.useState)(a.rule),[j,$]=(0,t.useState)((e=>{const t=b.keys();for(const l of t)if(b[l].value===e)return b[l];return b[0]})(a.rule.displayMode)),[U,A]=(0,t.useState)((e=>{const t=f.keys();for(const l of t)if(f[l].value===e)return f[l];return f[0]})(a.rule.logicalMode)),B=e=>{N(e),a.setter(V.order,e)},[L]=(0,t.useState)("eye"),[z]=(0,t.useState)("eye-slash");var H,_,W,G,q,K,Q;return(0,t.useEffect)((()=>{if(a.context.data){let t=[],l=new Set,r=new Map;for(const e of a.context.data){let t=h(e,"last");for(const e of t)l.add(e.name),e.fieldType&&r.set(e.name,e.fieldType)}for(const a of l){const l=r.get(a)||"unknown";let o="";l===e.FieldType.time?o=" (time)":l===e.FieldType.number?o=" (number)":l===e.FieldType.string&&(o=" (string)"),t.push({label:`${a}${o}`,value:a})}D(t)}}),[a.context.data]),l().createElement(r.Card,{heading:"",key:`rule-card-${a.ID}`},l().createElement(r.Card.Meta,null,l().createElement(r.FieldSet,null,l().createElement(r.Field,{label:"Rule Name",disabled:!V.showRule},l().createElement(r.Input,{value:V.name,placeholder:"",disabled:!V.showRule,onChange:e=>B(x(E({},V),{name:e.currentTarget.value}))})),l().createElement(r.Field,{label:"Metric",disabled:!V.showRule,style:{minWidth:"175px"}},l().createElement(r.Cascader,{key:`cmi-index-${a.ID}`,initialValue:V.seriesMatch,allowCustomValue:!0,placeholder:"Ð¡hoose a metric or enter a regular expression",options:M,onSelect:e=>B(x(E({},V),{seriesMatch:e}))})),l().createElement(r.Field,{label:"Alias metric name",description:"Used as metric name if exists"},l().createElement(r.Input,{value:V.alias,placeholder:"Enter alias or a regular expression",disabled:!V.showRule,onChange:e=>B(x(E({},V),{alias:e.currentTarget.value}))})),l().createElement(r.Field,{label:"Description",description:"Used on tooltip if exists"},l().createElement(r.TextArea,{value:V.description,placeholder:"",style:{resize:"both"},disabled:!V.showRule,onChange:e=>B(x(E({},V),{description:e.currentTarget.value}))})),l().createElement(r.Field,{label:"Show metric name",description:"Toggle Display of metric name",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.showName,disabled:!V.showRule,onChange:()=>{const e=V.showName;B(x(E({},V),{showName:!e}))}})),l().createElement(r.Field,{label:"Show metric value",description:"Toggle Display of metric value",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.showValue,disabled:!V.showRule,onChange:()=>{const e=V.showValue;B(x(E({},V),{showValue:!e}))}})),l().createElement(r.Field,{label:"Display Mode",description:"Metric handler type",disabled:!V.showRule},l().createElement(r.Select,{menuShouldPortal:!0,value:j,onChange:e=>{$(e),B(x(E({},V),{displayMode:e.value}))},options:b})),"number"===V.displayMode?l().createElement(l().Fragment,null,l().createElement(r.Field,{label:"Show only on Threshold",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.showOnlyOnThreshold,disabled:!V.showRule,onChange:()=>B(x(E({},V),{showOnlyOnThreshold:!V.showOnlyOnThreshold}))})),l().createElement(r.Field,{label:"Revers logic",description:"Inverse processing of values, if processing is needed from the largest to the smallest.",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.revers,disabled:!V.showRule,onChange:()=>B(x(E({},V),{revers:!V.revers}))})),"          ",l().createElement(r.Field,{label:"Use Custom Thresholds",description:"Define your own set of thresholds",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.useCustomThresholds||!1,disabled:!V.showRule,onChange:()=>{let e=V.customThresholds;e&&0!==e.length||(e=[{name:"information",value:"1",color:"#8ab8ff",textColor:"#000000",order:0},{name:"warning",value:"2",color:"#e0b400",textColor:"#000000",order:1},{name:"average",value:"3",color:"#fa6400",textColor:"#000000",order:2},{name:"high",value:"4",color:"#d95c1d",textColor:"#ffffff",order:3},{name:"disaster",value:"5",color:"#c4162a",textColor:"#ffffff",order:4}]),B(x(E({},V),{useCustomThresholds:!V.useCustomThresholds,customThresholds:e}))}})),V.useCustomThresholds?l().createElement(y,{thresholds:V.customThresholds||[],onChange:e=>{B(x(E({},V),{customThresholds:e}))}}):l().createElement(l().Fragment,null,l().createElement(r.Field,{label:"Information threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(H=null===(n=V.numberThreshold)||void 0===n||null===(o=n.information)||void 0===o?void 0:o.toString())&&void 0!==H?H:"",placeholder:"1",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{information:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.information)&&void 0!==l?l:null})}))}})),l().createElement(r.Field,{label:"Minor threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(_=null===(s=V.numberThreshold)||void 0===s||null===(i=s.minor)||void 0===i?void 0:i.toString())&&void 0!==_?_:"",placeholder:"1.5",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{minor:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.minor)&&void 0!==l?l:null})}))}})),l().createElement(r.Field,{label:"Warning threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(W=null===(d=V.numberThreshold)||void 0===d||null===(u=d.warning)||void 0===u?void 0:u.toString())&&void 0!==W?W:"",placeholder:"2",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{warning:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.warning)&&void 0!==l?l:null})}))}})),l().createElement(r.Field,{label:"Average threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(G=null===(m=V.numberThreshold)||void 0===m||null===(c=m.average)||void 0===c?void 0:c.toString())&&void 0!==G?G:"",placeholder:"3",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{average:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.average)&&void 0!==l?l:null})}))}})),l().createElement(r.Field,{label:"High threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(q=null===(g=V.numberThreshold)||void 0===g||null===(p=g.high)||void 0===p?void 0:p.toString())&&void 0!==q?q:"",placeholder:"4",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{high:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.high)&&void 0!==l?l:null})}))}})),l().createElement(r.Field,{label:"Critical threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(K=null===(T=V.numberThreshold)||void 0===T||null===(w=T.critical)||void 0===w?void 0:w.toString())&&void 0!==K?K:"",placeholder:"4.5",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{critical:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.critical)&&void 0!==l?l:null})}))}})),l().createElement(r.Field,{label:"Disaster threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null!==(Q=null===(C=V.numberThreshold)||void 0===C?void 0:C.disaster)&&void 0!==Q?Q:"",placeholder:"5",onChange:e=>{var t,l;return B(x(E({},V),{numberThreshold:x(E({},V.numberThreshold),{disaster:e.currentTarget.value.match(/^[\d.]*$/)?e.currentTarget.value:null!==(l=null===(t=V.numberThreshold)||void 0===t?void 0:t.disaster)&&void 0!==l?l:null})}))},type:"text",onKeyDown:e=>(69===e.keyCode||190===e.keyCode)&&e.preventDefault()})))):null,"string"===V.displayMode?l().createElement(l().Fragment,null,l().createElement(r.Field,{label:"Show only on Threshold",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.showOnlyOnThreshold,disabled:!V.showRule,onChange:()=>B(x(E({},V),{showOnlyOnThreshold:!V.showOnlyOnThreshold}))})),l().createElement(r.Field,{label:"Information threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(S=V.stringThreshold)||void 0===S?void 0:S.information,placeholder:"Information",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{information:e.currentTarget.value})}))})),l().createElement(r.Field,{label:"Minor threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(k=V.stringThreshold)||void 0===k?void 0:k.minor,placeholder:"Minor",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{minor:e.currentTarget.value})}))})),l().createElement(r.Field,{label:"Warning threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(O=V.stringThreshold)||void 0===O?void 0:O.warning,placeholder:"Warning",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{warning:e.currentTarget.value})}))})),l().createElement(r.Field,{label:"Average threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(F=V.stringThreshold)||void 0===F?void 0:F.average,placeholder:"Average",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{average:e.currentTarget.value})}))})),l().createElement(r.Field,{label:"High threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(R=V.stringThreshold)||void 0===R?void 0:R.high,placeholder:"High",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{high:e.currentTarget.value})}))})),l().createElement(r.Field,{label:"Critical threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(I=V.stringThreshold)||void 0===I?void 0:I.critical,placeholder:"Critical",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{critical:e.currentTarget.value})}))})),l().createElement(r.Field,{label:"Disaster threshold",disabled:!V.showRule},l().createElement(r.Input,{value:null===(P=V.stringThreshold)||void 0===P?void 0:P.disaster,placeholder:"Disaster",onChange:e=>B(x(E({},V),{stringThreshold:x(E({},V.stringThreshold),{disaster:e.currentTarget.value})}))}))):null,"show"===V.displayMode?l().createElement(l().Fragment,null,l().createElement(r.Field,{label:"Use logical expressions",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.logicExpress,disabled:!V.showRule,onChange:()=>B(x(E({},V),{logicExpress:!V.logicExpress}))})),V.logicExpress?l().createElement(l().Fragment,null,l().createElement(r.Field,{label:"Logical Mode",disabled:!V.showRule},l().createElement(r.Select,{menuShouldPortal:!0,value:U,onChange:e=>{A(e),B(x(E({},V),{logicalMode:e.value}))},options:f})),l().createElement(r.Field,{label:"Value",disabled:!V.showRule},l().createElement(r.Input,{value:V.logicExpressValue,placeholder:"100500",onChange:e=>B(x(E({},V),{logicExpressValue:e.currentTarget.value}))}))):null):null,l().createElement(r.Field,{label:"Use Custom Formatting",description:"Apply custom formatting to this metric",disabled:!V.showRule},l().createElement(r.Switch,{transparent:!0,value:V.useCustomFormatting,disabled:!V.showRule,onChange:()=>B(x(E({},V),{useCustomFormatting:!V.useCustomFormatting}))})),V.useCustomFormatting?l().createElement(l().Fragment,null,l().createElement(r.Field,{label:"Unit Format",description:"Format for displaying values",disabled:!V.showRule},l().createElement(r.Select,{menuShouldPortal:!0,options:v,value:v.find((e=>e.value===V.unitFormat))||v[0],onChange:e=>B(x(E({},V),{unitFormat:e.value})),placeholder:"Select unit format"})),l().createElement(r.Field,{label:"Decimals",description:"Number of decimal places to show",disabled:!V.showRule},l().createElement(r.Input,{value:void 0!==V.decimals?V.decimals.toString():"",type:"number",placeholder:"Auto",min:0,max:20,onChange:e=>{const t=e.currentTarget.value,l=""!==t?parseInt(t,10):void 0;B(x(E({},V),{decimals:l}))}}))):null)),l().createElement(r.Card.Actions,null,l().createElement(r.IconButton,{key:"moveUp",name:"arrow-up",tooltip:"Move Up",onClick:()=>{a.moveUp(V.order)}}),l().createElement(r.IconButton,{key:"moveDown",name:"arrow-down",tooltip:"Move Down",onClick:()=>{a.moveDown(V.order)}}),l().createElement(r.IconButton,{key:"showRule",name:V.showRule?L:z,tooltip:"Hide/Show Rule",onClick:()=>B(x(E({},V),{showRule:!V.showRule}))}),l().createElement(r.IconButton,{key:"copyRule",name:"copy",tooltip:"Duplicate",onClick:()=>{a.createDuplicate(V.order)}}),l().createElement(r.IconButton,{key:"deleteRule",variant:"destructive",name:"trash-alt",tooltip:"Delete Rule",onClick:()=>{a.remover(V.order)}})))},k={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let O;const F=new Uint8Array(16);function R(){if(!O&&(O="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(F)}const I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));const P=function(e,t,l){if(k.randomUUID&&!t&&!e)return k.randomUUID();const a=(e=e||{}).random||(e.rng||R)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){l=l||0;for(let e=0;e<16;++e)t[l+e]=a[e];return t}return function(e,t=0){return(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase()}(a)},M=({context:e,onChange:a})=>{const[o]=(0,t.useState)(e.options.ruleConfig),[n,i]=(0,t.useState)((()=>{if(!o.rules)return[];const e=[];return o.rules.forEach(((t,l)=>{e[l]={rule:t,order:l,ID:P()}})),e})),s=e=>{i(e);const t=[];e.forEach((e=>{t.push(e.rule)})),a({rules:t})},[u,d]=(0,t.useState)((()=>{if(!n)return[];let e=n.length;const t=[];for(;e--;)t[e]=!1;return t})),c=(e,t,l)=>{if(l>=e.length){let t=l-e.length+1;for(;t--;)e.push(void 0)}e.splice(l,0,e.splice(t,1)[0])},h=e=>{if(e!==n.length-1){c(n,e,e+1);for(let e=0;e<n.length;e++)n[e].order=e,n[e].rule.order=e;s([...n])}},m=e=>{if(e>0){c(n,e,e-1);for(let e=0;e<n.length;e++)n[e].order=e,n[e].rule.order=e;s([...n])}},p=e=>{const t=n[e].rule,l=n.length,a={rule:{name:`${t.name} Copy`,label:`${t.name} Copy`,order:l,isTemplated:t.isTemplated,displayMode:t.displayMode,enabled:t.enabled,showName:t.showName,showValue:t.showValue,showRule:t.showRule,showMembers:t.showMembers,logicExpress:t.logicExpress,logicExpressValue:t.logicExpressValue,clickThrough:t.clickThrough,clickThroughOpenNewTab:t.clickThroughOpenNewTab,clickThroughSanitize:t.clickThroughSanitize,alias:t.alias,description:t.alias,shortAlias:t.shortAlias,seriesMatch:t.seriesMatch,logicalMode:t.logicalMode,numberThreshold:t.numberThreshold,stringThreshold:t.stringThreshold,showOnlyOnThreshold:t.showOnlyOnThreshold,revers:t.revers,useCustomFormatting:t.useCustomFormatting,unitFormat:t.unitFormat,decimals:t.decimals},order:l,ID:P()};s([...n,a]),d([...u,!0])},g=(e,t)=>{n[e].rule=t,s([...n])},v=e=>{const t=[...n];let l=0;for(let a=0;a<t.length;a++)if(t[a].order===e){l=a;break}t.splice(l,1);for(let e=0;e<t.length;e++)t[e].order=e,t[e].rule.order=e;s([...t])};return l().createElement(l().Fragment,null,l().createElement(r.Button,{style:{marginBottom:"16px"},fill:"solid",variant:"primary",icon:"plus",onClick:()=>{const e=n.length,t={rule:{name:`Rule-${e}`,label:`Rule-${e}`,showName:!0,showValue:!0,showMembers:!1,showOnlyOnThreshold:!1,revers:!1,numberThreshold:{information:"",minor:"",warning:"",average:"",high:"",critical:"",disaster:""},stringThreshold:{information:"",minor:"",warning:"",average:"",high:"",critical:"",disaster:""},logicExpress:!1,logicalMode:f[0].value,logicExpressValue:"",showRule:!0,isTemplated:!1,enabled:!0,displayMode:b[0].value,clickThrough:"",clickThroughOpenNewTab:!0,clickThroughSanitize:!0,order:e,alias:"",description:"",shortAlias:"",seriesMatch:"",useCustomFormatting:!1,unitFormat:void 0,decimals:void 0},order:e,ID:P()};s([...n,t]),d([...u,!0])}},"Add Rule"),n&&n.map(((t,a)=>l().createElement(r.Collapse,{key:`collapse-item-index-${t.ID}`,label:t.rule.name,isOpen:u[a],onToggle:()=>(e=>{const t=[...u];t[e]=!t[e],d([...t])})(a),collapsible:!0},l().createElement(S,{key:`rule-item-index-${t.ID}`,ID:t.ID,rule:t.rule,enabled:t.rule.enabled,setter:g,remover:v,moveUp:m,moveDown:h,createDuplicate:p,context:e})))))},D="rgba(55, 135, 45, 0.9)",V="rgba(196, 22, 42, 0.9)",N="rgba(205, 49, 49, 0.9)",j="rgba(217, 92, 29, 0.9)",$="rgba(250, 100, 0, 0.99)",U="rgba(224, 180, 0, 0.99)",A="rgba(190, 213, 255, 0.99)",B="rgba(138, 184, 255, 0.99)",L="rgba(128, 128, 128, 0.9)",z="rgba(20, 60, 120, 0.9)",H=new e.PanelPlugin((({options:n,data:s,width:u,height:c,id:h,replaceVariables:m})=>{const[b,f]=(0,t.useState)(null),[v,w]=(0,t.useState)(!1),[y,T]=(0,t.useState)([]),C=(0,t.useMemo)((()=>[]),[]),E=function(e,t){if("object"==typeof e){if(e.customColor&&e.textColor)return{backgroundColor:e.customColor,textColor:e.textColor};if(e.customColor)return e.customColor}switch("object"==typeof e?e.state:e){case"ok-state":return t.ColorOK;case"disaster-state":return t.ColorDisaster;case"critical-state":return t.ColorCritical;case"high-state":return t.ColorHigh;case"average-state":return t.ColorAverage;case"warning-state":return t.ColorWarning;case"minor-state":return t.ColorMinor;case"information-state":return t.ColorInformation;case"disable-state":return t.ColorDisable;case"na-state":return t.ColorNa;default:return"rgba(0, 0, 0, 0)"}}(null!=b?b:"",n),x="string"==typeof E?E:E.backgroundColor,S="string"==typeof E?void 0:E.textColor,k=(0,r.useStyles2)((e=>({wrapper:a.css`
        position: relative;
      `,svg:a.css`
        position: absolute;
        top: 0;
        left: 0;
      `,textBox:a.css`
        position: absolute;
        bottom: 0;
        left: 0;
        padding: 10px;
      `,valueMap:a.css`
        font-size: 0.85em;
        line-height: ${n.lineHeight||1.5}em;
      `,bottom_section:a.css`
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-content: center; 
        height: 100%;
      `,top_section:a.css`
        box-sizing: inherit;
        vertical-align: middle;
        height: 100%;
      `,status_name_row:a.css`
        overflow: hidden;
        color: ${S||"#080808"};
      `,h1:{margin:`0px 0px ${n.titleMargin||10}px`,fontSize:"1.4rem","padding-top":"3px","letter-spacing":"-0.01893em"},a:{color:S||"#080808"},blink:a.css`
      animation-name: blinker;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(1.0,2.0,0,1.0);
      animation-duration: 1s;
      animation-play-state: running;
      -webkit-animation-name: blinker;
      -webkit-animation-iteration-count: infinite;
      -webkit-animation-play-state: running;
      -webkit-animation-timing-function: cubic-bezier(1.0,2.0,0,1.0);
      -webkit-animation-duration: 1s;
      `})));(0,t.useEffect)((()=>{w(!1),"enable"===n.statePanel?f(o(p(s),n.ruleConfig.rules)):"na"===n.statePanel?f("na-state"):f("disable-state")}),[s,n.ruleConfig.rules,n.statePanel]),(0,t.useEffect)((()=>{w(!1);const e=null===b?null:"object"==typeof b?b.state:b;"not-ok-state"!==C[h]&&"ok-state"===e?(void 0!==C[h]&&w(!0),C[h]="not-ok-state"):"not-disaster-state"!==C[h]&&"disaster-state"===e?(void 0!==C[h]&&w(!0),C[h]="not-disaster-state"):"not-high-state"!==C[h]&&"high-state"===e?(void 0!==C[h]&&w(!0),C[h]="not-high-state"):"not-average-state"!==C[h]&&"average-state"===e?(void 0!==C[h]&&w(!0),C[h]="not-average-state"):"not-warning-state"!==C[h]&&"warning-state"===e?(void 0!==C[h]&&w(!0),C[h]="not-warning-state"):"not-information-state"!==C[h]&&"information-state"===e&&(void 0!==C[h]&&w(!0),C[h]="not-information-state")}),[h,b,C]);const O=v&&n.blink?k.blink:"";return(0,t.useEffect)((()=>{let t=function(t,l){const a={};t.forEach((e=>{a[e.label]?a[e.label]++:a[e.label]=1})),Object.entries(a).forEach((([t,l])=>{l>1&&"Time"!==t&&(0,d.getAppEvents)().publish({type:e.AppEvents.alertWarning.name,payload:[`Warning: multiple metrics with the label "${t}" were found.`]})}));const r=[];if(l){for(const a of l){let l;for(const n of t)if(new RegExp(a.seriesMatch).test(n.label)){if(l=n,!l)continue;if(l){if(("number"===a.displayMode||"string"===a.displayMode)&&a.showOnlyOnThreshold&&"ok-state"===o([l],[a]))continue;const t=l.value;let n=!0;if("show"===a.displayMode&&a.logicExpress&&(n=i(t,a.logicExpressValue,a.logicalMode)),n){let o="";if(a.showName)if(a.alias)try{const e=new RegExp(a.alias).exec(l.label);e&&e[1]?o+=e[1]:o+=a.alias}catch(e){o+=a.alias}else o+=l.label;if(a.showName&&a.showValue&&(o+=": "),a.showValue)if(a.useCustomFormatting&&a.unitFormat)try{const l=(0,e.getValueFormat)(a.unitFormat)(t,void 0!==a.decimals?a.decimals:2);o+=(0,e.formattedValueToString)(l)}catch(e){console.error("Error formatting value:",e),l.valueFormatted?o+=l.valueFormatted:o+=t}else l.valueFormatted?o+=l.valueFormatted:o+=t;(a.showName||a.showValue)&&r.push({line:o,tooltip:a.description?a.description:""})}}}}return r}}(p(s),n.ruleConfig.rules);T(t||[])}),[s,n]),l().createElement("div",{className:(0,a.cx)(k.wrapper,O,g,a.css`
          width: ${u+16}px;
          height: ${c+16}px;
	        text-align: center;
          overflow: hidden;
          position: relative;
          border-radius: 3px;
          backface-visibility: hidden;
          transition: transform 0.5s;
	        margin: -8px 0 0 -8px;
          background-color: ${x};
        `)},l().createElement("div",{className:k.top_section},l().createElement("div",{className:k.bottom_section},l().createElement("div",{className:k.status_name_row},l().createElement("h1",{style:k.h1},n.dataLink?l().createElement("a",{style:k.a,href:m(n.dataLink)},m(n.panelName)):l().createElement("span",{style:k.a},m(n.panelName))),"enable"===n.statePanel?l().createElement("div",{className:k.valueMap},n.modePanel&&"in"===n.modePanel?y.map(((e,t)=>l().createElement("span",{key:t,style:{marginRight:t<y.length-1?`${n.inlineSpacing||10}px`:"0"}},e.tooltip?l().createElement(r.Tooltip,{content:l().createElement("div",{style:{whiteSpace:"pre-wrap"}},e.tooltip)},l().createElement("span",null,e.line)):l().createElement("span",null,e.line),l().createElement("span",null,t<y.length-1?" / ":"")))):y.map(((e,t)=>l().createElement("div",{key:t,style:{marginBottom:`${n.textSpacing||5}px`}},e.tooltip?l().createElement(r.Tooltip,{content:l().createElement("div",{style:{whiteSpace:"pre-wrap"}},e.tooltip)},l().createElement("span",null,e.line)):l().createElement("span",null,e.line))))):""))))})).setPanelOptions((e=>e.addTextInput({path:"panelName",name:"Panel name",category:["General"],defaultValue:"Example name panel"}).addRadio({path:"statePanel",defaultValue:"enable",name:"State panel",category:["General"],settings:{options:[{value:"enable",label:"Enable"},{value:"disable",label:"Disable"},{value:"na",label:"N/A"}]}}).addRadio({path:"modePanel",defaultValue:"line",name:"Mode panel",category:["General"],settings:{options:[{value:"line",label:"Line by line"},{value:"in",label:"In one line"}]}}).addBooleanSwitch({name:"Blink",path:"blink",defaultValue:!0,category:["General"]}).addTextInput({path:"dataLink",name:"DataLink",category:["General"],description:"Used on panel name if exist.\n\tExample: d/HQgMW5LVk/new-dashboard?orgId=1&refresh=30s&var-query0=$query0",defaultValue:""}).addNumberInput({path:"titleMargin",name:"Title Margin",category:["Text Spacing"],description:"Margin below the title (px)",defaultValue:10,settings:{min:0,max:50,integer:!0}}).addNumberInput({path:"lineHeight",name:"Line Height",category:["Text Spacing"],description:"Line height for metrics (em)",defaultValue:1.5,settings:{min:1,max:3,step:.1}}).addNumberInput({path:"textSpacing",name:"Text Spacing",category:["Text Spacing"],description:"Spacing between metric rows (px)",defaultValue:5,settings:{min:0,max:20,integer:!0},showIf:e=>"in"!==e.modePanel}).addNumberInput({path:"inlineSpacing",name:"Inline Spacing",category:["Text Spacing"],description:"Spacing between metrics when displayed inline (px)",defaultValue:10,settings:{min:0,max:50,integer:!0},showIf:e=>"in"===e.modePanel}).addColorPicker({name:"OK Color (default: "+D+")",path:"ColorOK",category:["Color"],defaultValue:D,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"Disable Color (default: "+L+")",path:"ColorDisable",category:["Color"],defaultValue:L}).addColorPicker({name:"Information Color (default: "+B+")",path:"ColorInformation",category:["Color"],defaultValue:B,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"Minor Color (default: "+A+")",path:"ColorMinor",category:["Color"],defaultValue:A,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"Warning Color (default: "+U+")",path:"ColorWarning",category:["Color"],defaultValue:U,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"Average Color (default: "+$+")",path:"ColorAverage",category:["Color"],defaultValue:$,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"High Color (default: "+j+")",path:"ColorHigh",category:["Color"],defaultValue:j,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"Critical Color (default: "+N+")",path:"ColorCritical",category:["Color"],defaultValue:N,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"Disaster Color (default: "+V+")",path:"ColorDisaster",category:["Color"],defaultValue:V,showIf:e=>"enable"===e.statePanel}).addColorPicker({name:"N/A Color (default: "+z+")",path:"ColorNa",category:["Color"],defaultValue:z,showIf:e=>"enable"===e.statePanel}).addCustomEditor({name:"Rules",id:"ruleConfig",path:"ruleConfig",editor:M,defaultValue:{rule:[],enabled:!0,animationSpeed:"1500"},category:["Rules"]})))})(),u})()));
//# sourceMappingURL=module.js.map